---
title: React(Hooks)+Typescript ç±»å‹å®šä¹‰å®è·µ
date: 2021-08-31
tags:
  - React
  - Typescript
---

React ç»“åˆ Typescript çš„å¼€å‘æ¨¡å¼ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­è¿ç”¨æ¯”è¾ƒå¹¿æ³›ã€‚åœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œå‘ç°é¡¹ç›®ä¸­å„ç§ç±»å‹çš„å®šä¹‰ï¼Œå°¤ä¸ºå¤´ç–¼ï¼Œå› æ­¤åœ¨æŸ¥çœ‹äº†å¤šç¯‡åšå®¢æ–‡ç« ä¹‹åæ€»ç»“äº†ä¸€ä¸‹ã€‚éšç€ Hooks çš„å‡ºç°ï¼Œå‡½æ•°ç»„ä»¶åŸºæœ¬ä¸Šå¯ä»¥å®Œå…¨å–ä»£ç±»ç»„ä»¶äº†ï¼Œå› æ­¤æœ¬æ–‡ç€é‡è®²å‡½æ•°ç»„ä»¶çš„å¼€å‘å®è·µã€‚

## æ•°æ®ç±»å‹å®šä¹‰

- **åŸºç¡€ç±»å‹**

```js
interface IProps {
  name: string; //å­—ç¬¦ä¸²
  done: boolean; //å¸ƒå°”å€¼
  age: number; //æ•°å­—
  list: number[]; // æ•°ç»„ï¼Œå®šä¹‰å…ƒç´ ç±»å‹
  optional?: string; // å¯é€‰å‚æ•°
}
```

- **å¯¹è±¡ç±»å‹**

```js
interface IProps {
  data: object; // ä¸æ¨èè¿™ä¹ˆå†™ï¼Œå¯¹è±¡å±æ€§å¤ªæ¨¡ç³Š
  data1: {
    id: number,
    name: string
  }; // å¯¹è±¡å±æ€§ç±»å‹å®šä¹‰ï¼Œå¸¸ç”¨
  dataArr: {
    id: number,
    name: string
  }[]; // å¯¹è±¡æ•°ç»„å¸¸ç”¨
  dic: {
    [key: string]: customType
  }; // keyå€¼å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œå€¼é™åˆ¶ä¸ºcustomTypeè‡ªå®šä¹‰ç±»å‹
  dic1: Record<string, customType>; // å’Œdicä¸€æ ·ï¼Œç”¨äº†TSå†…ç½®çš„Recordç±»å‹
}
```

> å…¶ä¸­ dic å’Œ dic1 çš„å®šä¹‰æ–¹å¼å¯ä»¥ç”¨äº ajax è¯·æ±‚çš„è¿”å›å€¼ï¼Œå› ä¸ºå­—æ®µä¸ç¡®å®šï¼Œä½† key ä¸€èˆ¬éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹

- **å‡½æ•°ç±»å‹**

```js
interface FunctionProps {
  /** ä»»æ„çš„å‡½æ•°ç±»å‹ âŒ ä¸æ¨è ä¸èƒ½è§„å®šå‚æ•°ä»¥åŠè¿”å›å€¼ç±»å‹ */
  onSomething: Function;
  /** æ²¡æœ‰å‚æ•°çš„å‡½æ•° ä¸éœ€è¦è¿”å›å€¼ ğŸ˜ å¸¸ç”¨ */
  onClick: () => void;
  /** å¸¦å‡½æ•°çš„å‚æ•° ğŸ˜ éå¸¸å¸¸ç”¨ */
  onChange: (id: number) => void;
  /** å¦ä¸€ç§å‡½æ•°è¯­æ³• å‚æ•°æ˜¯ React çš„æŒ‰é’®äº‹ä»¶ ğŸ˜ éå¸¸å¸¸ç”¨ */
  onClick(event: React.MouseEvent<HTMLButtonElement>): void;
}
```

- **React å†…ç½®ç±»å‹**

```js
interface IReact{
  style:React.CSSProperties //ç»„ä»¶å†…è”çš„styleå¯¹è±¡çš„ç±»å‹
  node:React.ReactNode // ç»„ä»¶èŠ‚ç‚¹ç±»å‹
  ele:React.React.ReactElement // ä½¿ç”¨React.createElementåˆ›å»ºçš„ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºReactä¸­çš„JSXçš„å…ƒç´ 
}
```

## å¦‚ä½•å®šä¹‰å‡½æ•°ç»„ä»¶çš„ç±»å‹

React ä¸­æœ‰å¤šç§ç±»å‹å¯ä»¥ç”¨æ¥å®šä¹‰ç»„ä»¶ç±»å‹ï¼Œæ¥ä¸‹æ¥å°±ç»“åˆå®ä¾‹æ¥è®²è§£å„è‡ªçš„ç‰¹ç‚¹ã€‚

ç°åœ¨æœ‰ä¸€ä¸ª `Hello` ç»„ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ª `name` å±æ€§

```ts
// Hello.tsx
import React from 'react';

interface IProps {
  name: string;
}

const Hello = (props: IProps) => {
  return (
    <div>
      <div>hello!{props.name}</div>
    </div>
  );
};

export default Hello;
```

è¿™é‡Œç±»å‹å®šä¹‰ç”¨`interface`æˆ–è€…`type`éƒ½å¯ä»¥ï¼Œçœ‹ä¸ªäººå–œå¥½ã€‚å¦‚æœç”¨`type`ï¼Œåˆ™è¿™æ ·å†™:

```ts
type IProps = {
  name: string;
};
```

ç„¶åï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­æ¸²æŸ“ï¼Œå¹¶ä¼ é€’å‚æ•°

```ts
// index.ts
import React from 'react';
import { render } from 'react-dom';
import Hello from './Hello';
import './style.css';

const App = () => {
  return (
    <div>
      <Hello name={'world'} />
    </div>
  );
};

render(<App />, document.getElementById('root'));
```

è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œç±»å‹çš„å®šä¹‰æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

ä½†ç°åœ¨æœ‰ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨`Hello`ç»„ä»¶ä¸­æ¸²æŸ“å…¶ä»–æ–°çš„ç»„ä»¶ã€‚æ¯”å¦‚ï¼š

```ts
const App = () => {
  return (
    <div>
      <Hello name={'world'}>
        <button>click</button>
      </Hello>
    </div>
  );
};
```

è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨`Hello`ç»„ä»¶ä¸­æ¸²æŸ“`children`å³å¯ã€‚

```ts
interface IProps {
  name: string;
  children:?//æ€ä¹ˆå»å®šä¹‰è¿™ä¸ªchildrenç±»å‹å‘¢
}

const Hello = (props: IProps) => {
  return (
    <div>
      <div>hello!{props.name}</div>
      {props.children}
    </div>
  );
};
```

`chilren`æ€ä¹ˆå®šä¹‰ç±»å‹ï¼Ÿ

1. `JSX.Element`: ä¸æ¨èï¼Œå•ä¸ªå­ç»„ä»¶å¯ç”¨ï¼Œæ²¡æœ‰è€ƒè™‘æ•°ç»„

2. `JSX.Element | JSX.Element[]`: ä¸æ¨èï¼Œæ²¡æœ‰è€ƒè™‘å­—ç¬¦ä¸² children

3. `React.ReactChild[]`: æ²¡æœ‰è€ƒè™‘ null

4. `React.ReactNode`ï¼šåŒ…å«æ‰€æœ‰ children æƒ…å†µ

æ‰€ä»¥ï¼Œè¿™é‡Œ`children`å®šä¹‰ä¸º`React.ReactNode`æœ€ä¸ºåˆé€‚

```ts
interface IProps {
  name: string;
  children: React.ReactNode;
}
```

å…¶å®ï¼Œå¯¹äºå‡½æ•°ç»„ä»¶è€Œè¨€ï¼ŒReact ä¸­è¿˜æœ‰ä¸€ä¸ª `FC` å†…ç½®ç±»å‹ï¼Œä¸“é—¨ç”¨äºå‡½æ•°ç»„ä»¶ç±»å‹å®šä¹‰ã€‚ç”¨ `FC` ç»„ä»¶çš„å¥½å¤„æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨åŒ…å« `children` ,å› æ­¤æˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨å»ä¸º `children` å®šä¹‰ç±»å‹

```ts
import React, { FC } from 'react';

interface IProps {
  name: string;
}

const Hello: FC<IProps> = ({ name, children }) => {
  return (
    <div>
      <div>hello!{name}</div>
      {children}
    </div>
  );
};

export default Hello;
```

ç»¼ä¸Šï¼Œ`FC`ç±»å‹æ˜¯å‡½æ•°ç»„ä»¶ç±»å‹å®šä¹‰çš„æœ€ä½³é€‰æ‹©ã€‚

### Hooks

- **useState**

å¦‚æœä½ çš„é»˜è®¤å€¼å·²ç»å¯ä»¥è¯´æ˜ç±»å‹ï¼Œåˆ™ä¸éœ€è¦æ‰‹åŠ¨å£°æ˜ç±»å‹ï¼ŒTS ä¼šè‡ªè¡Œæ¨æ–­ã€‚

```ts
// count: numberç±»å‹
const [count, setCount] = useState(0);
const change = () => {
  setCount(count + 1);
};
```

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®¾å®šåˆå§‹å€¼ä¸º`null`æˆ–`undefined`ï¼Œæ­¤æ—¶å°±è¦é€šè¿‡èŒƒå‹æ‰‹åŠ¨ä¼ å…¥ä½ æœŸæœ›çš„ç±»å‹ã€‚

```ts
import React, { useState } from 'react';

interface Person {
  name: string;
  age: number;
}

const [person, setPerson] = useState<Person | null>(null);

const getName = () => {
  console.log(person.name);
};
```

> è¿™æ ·å½“ä½ è®¿é—®`person`ä¸Šçš„å±æ€§æ—¶ï¼Œä¼šæ”¶åˆ°`Object is possibly 'null'.`çš„æç¤ºã€‚é€šè¿‡`?.`å¯é€‰é“¾æ“ä½œç¬¦è¯­æ³•å¯ä»¥é¿å…è¿™ä¸ªé”™è¯¯ã€‚å…³äºå¯é€‰é“¾æ“ä½œæ³•å¯ä»¥ç‚¹å‡»[æ­¤å¤„](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining)æŸ¥çœ‹

- **useEffect**

`useEffect`ä¼ å…¥çš„å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼ˆæ¸…ç†å‡½æ•°ï¼‰,è¦ä¹ˆå°±æ˜¯`undefined`ï¼Œå…¶ä»–æƒ…å†µéƒ½ä¼šæŠ¥é”™ã€‚

æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µå°±æ˜¯ï¼Œ`useEffect`ä¸­æ‰§è¡Œäº†ä¸€ä¸ª`async`å‡½æ•°ï¼Œæ¯”å¦‚:

```js
// æç¤ºArgument of type '() => Promise<void>' is not assignable to parameter of type 'EffectCallback'.
useEffect(async () => {
  const num = await getCount();
  setCount(num);
}, []);
```

å› ä¸º async å‡½æ•°é»˜è®¤ä¼šè¿”å›ä¸€ä¸ª Promise,å¯¼è‡´ TS æŠ¥é”™

æ¨èè¿™æ ·å†™ï¼š

```ts
useEffect(() => {
  const fn = async () => {
    const num = await getCount();
    setCount(num);
  };

  fn();
}, []);
```

- **useReducer**

`useReducer`æ¥æ”¶ä¸¤ä¸ªå‚æ•°`reducer` å’Œ`initialState`ï¼Œåªè¦å¯¹ä¼ å…¥`useReducer`çš„`reducer`å‡½æ•°çš„`state`å’Œ`action`è¿›è¡Œç±»å‹çº¦æŸï¼Œå°±å¯ä»¥æ¨æ–­å‡ºç±»å‹ã€‚åœ¨ä½¿ç”¨`useReducer`çš„æ—¶å€™ï¼Œè”åˆç±»å‹å°±éå¸¸æœ‰ç”¨ã€‚

```ts
import React, { useReducer } from 'react';

const initialState = { count: 0 };

/** è”åˆç±»å‹ï¼Œä½¿ç”¨ | è¿æ¥ */
type ACTIONTYPE =
  | { type: 'increment'; payload: number }
  | { type: 'decrement'; payload: string }
  | { type: 'reset'; payload: number };

function reducer(state: typeof initialState, action: ACTIONTYPE) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + action.payload };
    case 'decrement':
      return { count: state.count - Number(action.payload) };
    case 'reset':
      return { count: action.payload };
    default:
      throw new Error();
  }
}

const Counter: React.FC = () => {
  const [state, dispatch] = useReducer(reducer, initialState);
  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({ type: 'decrement', payload: '5' })}>-</button>
      <button onClick={() => dispatch({ type: 'increment', payload: 5 })}>+</button>
      <button onClick={() => dispatch({ type: 'reset', payload: 0 })}>reset</button>
    </>
  );
};

export default Counter;
```

è¿™é‡Œï¼Œ`ACTIONTYPE`æ˜¯ä¸€ä¸ªè”åˆç±»å‹ï¼Œå½“ä¼ å…¥ç‰¹å®šçš„`type`æ—¶ï¼Œå‰©ä¸‹çš„ç±»å‹`payload`ä¼šè‡ªè¡ŒåŒ¹é…åˆ¤æ–­ã€‚

- **useRef**

`useRef` ä¼ é€’éç©ºåˆå§‹å€¼çš„æ—¶å€™å¯ä»¥æ¨æ–­ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥ç¬¬ä¸€ä¸ªæ³›å‹å‚æ•°æ¥å®šä¹‰ç±»å‹ï¼Œçº¦æŸ `ref.current` çš„ç±»å‹ã€‚

```ts
import React, { useLayoutEffect } from 'react';

export const App: React.FC = () => {
  const h1Ref = React.useRef<HTMLDivElement | null>(null);

  function changeInnerText(el: HTMLDivElement, value: string) {
    el.innerText = value;
  }

  useLayoutEffect(() => {
    if (null !== h1Ref.current) {
      changeInnerText(h1Ref.current, 'hello world');
    }
  }, []);

  return <h1 ref={h1Ref}>My title</h1>;
};

export default App;
```

æ›´å¤šå…ƒç´ ç±»å‹å®ä¾‹ï¼š

```tsx
// <div> reference type
const divRef = React.useRef<HTMLDivElement | null>(null);

// <button> reference type
const buttonRef = React.useRef<HTMLButtonElement | null>(null);

// <br /> reference type
const brRef = React.useRef<HTMLBRElement | null>(null);

// <a> reference type
const linkRef = React.useRef<HTMLLinkElement | null>(null);
```

### æ·»åŠ ç¬¬ä¸‰æ–¹ä¾èµ–åº“

å½“æˆ‘ä»¬éœ€è¦åœ¨ä»£ç åº“ä¸­æ·»åŠ ç¬¬ä¸‰æ–¹ä¾èµ–çš„æ—¶å€™ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æŸ¥çœ‹è¿™ä¸ªåº“æ˜¯å¦æ‹¥æœ‰ä¸€ä¸ªå¸¦æœ‰ `TypeScript` ç±»å‹å®šä¹‰ `@types` åŒ…ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š

```shell
# yarn
$ yarn add @types/<package-name>

# npm
$ npm install @types/<package-name>

```

æ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨é¡¹ç›®ä¸­å¼•å…¥ jestï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£… jest ä¾èµ–ï¼š

```shell
#yarn
\$ yarn add @types/jest

#npm
$ npm install @types/jest
```

å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¸¦æœ‰ `TypeScript` ç±»å‹å®šä¹‰ `@types` åŒ…ï¼Œä¾‹å¦‚ `loadsh` åœ¨ npm ä¸Šæ˜¯æ²¡æœ‰ `@types/loadsh` çš„ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ
é¦–å…ˆé€šè¿‡ npm æˆ–è€… yarn æ­£å¸¸å®‰è£… loadsh çš„ä¾èµ–ï¼š

```shell
#yarn
$ yarn add loadsh

#npm
\$ npm install loadsh
```

ç„¶ååœ¨é¡¹ç›®ä¸­çš„ src æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ° react-app-env.d.ts æ–‡ä»¶ï¼Œä¸º loadsh ä¾èµ–æ·»åŠ  declareï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç ï¼š

```ts
declare module 'loadsh' {
  const classes: any;
  export default classes;
}
```

ç„¶åæ­£å¸¸å¼•å…¥å³å¯ï¼š

```ts
import _ from 'loadsh';
```
